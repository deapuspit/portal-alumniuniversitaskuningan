<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Kelola User</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-4">

  <div class="d-flex justify-content-between mb-3">
    <h4>Kelola User</h4>
    <button class="btn btn-secondary btn-sm"
      onclick="location.href='dashboard.html'">
      ‚Üê Kembali
    </button>
  </div>
  <!-- TABLE -->
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nama</th>
        <th>Email</th>
        <th>Role</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="userTable"></tbody>
  </table>

</div>

<script src="../js/auth.js"></script>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyDS1ml_xKj_1BAvS6_eD9sMbbYDShc3IFUtONn4jV117sDkHgr1TkxhjFm-DF1FqjAVw/exec";

async function loadUsers() {
  const res = await fetch(API_URL + "?action=getUsers");
  const data = await res.json();

  const tbody = document.getElementById("userTable");
  tbody.innerHTML = "";

  data.forEach(u => {
    tbody.innerHTML += `
      <tr>
        <td>${u.id}</td>
        <td>${u.nama}</td>
        <td>${u.email}</td>
        <td>${u.role}</td>
        <td>
         <button
          class="btn btn-danger btn-sm"
          onclick="deleteUser('${u.id}')">
          Hapus
        </button>
      </tr>`;
  });
}

async function addUser() {
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "addUser",
      nama: nama.value,
      email: email.value,
      password: password.value,
      role: role.value
    })
  });
  loadUsers();
}

async function deleteUser(id) {
  if (!confirm("Yakin ingin menghapus user ini?")) return;

  const form = new FormData();
  form.append("action", "deleteUser");
  form.append("id", id);

  await fetch(API_URL, {
    method: "POST",
    body: form
  });

  alert("User berhasil dihapus");
  loadUsers();
}
loadUsers();
</script>

</body>
</html>
