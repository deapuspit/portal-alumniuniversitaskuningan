<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Detail Lowongan</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-4">

  <a href="index.html">← Kembali</a>

  <div class="card mt-3 shadow-sm">
    <img id="gambar" class="card-img-top">
    <div class="card-body">
  <h3 id="judul"></h3>
  <p><b>Perusahaan:</b> <span id="perusahaan"></span></p>
  <p><b>Lokasi:</b> <span id="lokasi"></span></p>
  <p id="deskripsi"></p>

  <a id="link" target="_blank" class="btn btn-primary mb-2">
    Kunjungi Website Perusahaan
  </a>

  <br>

  <button class="btn btn-success" onclick="apply()">
    Lamar Sekarang
  </button>
</div>
  </div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyDS1ml_xKj_1BAvS6_eD9sMbbYDShc3IFUtONn4jV117sDkHgr1TkxhjFm-DF1FqjAVw/exec";

const id = new URLSearchParams(window.location.search).get("id");

async function load() {
  const res = await fetch(API + "?action=getLowongan");
  const data = await res.json();

  const l = data.find(x => x.id == id);

  if (!l) {
    document.body.innerHTML = "Lowongan tidak ditemukan";
   return;
  }

  gambar.src = l.gambar || "img/loker.png";
  judul.innerText = l.judul;
  perusahaan.innerText = l.perusahaan;
  lokasi.innerText = l.lokasi;
  deskripsi.innerText = l.deskripsi;
  document.getElementById("link").href = l.link;
}

load();

async function apply() {

  const status = localStorage.getItem("alumni_status");
  if (status !== "Verified") {
    alert("Akun alumni Anda belum diverifikasi admin");
    return;
  }

  const form = new FormData();
  form.append("action", "applyLowongan");
  form.append("lowonganId", id); // ← pakai id dari URL
  form.append("judul", document.getElementById("judul").innerText);
  form.append("perusahaan", document.getElementById("perusahaan").innerText);
  form.append("nama", localStorage.getItem("nama"));
  form.append("email", localStorage.getItem("email"));

  try {
    await fetch(API, {
      method: "POST",
      mode: "no-cors",
      body: form
    });

    alert("Lamaran berhasil dikirim!");

  } catch (e) {
    alert("Gagal mengirim lamaran");
    console.error(e);
  }
}
</script>

</body>
</html>
