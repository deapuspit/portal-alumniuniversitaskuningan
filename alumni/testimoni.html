<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Testimoni Alumni</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<!-- PROTEKSI LOGIN ALUMNI -->
<script>
if (
  localStorage.getItem("login") !== "true" ||
  localStorage.getItem("role") !== "alumni"
) {
  location.href = "../index.html";
}
</script>

<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h4>üí¨ Testimoni Alumni</h4>
    <a href="dashboard.html" class="btn btn-secondary btn-sm">
      ‚Üê Kembali ke Dashboard
    </a>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">

      <p class="text-muted">
        Silakan tuliskan pengalaman kamu selama menjadi alumni Universitas Kuningan.
        Testimoni akan ditampilkan setelah disetujui admin.
      </p>

      <textarea id="isi" class="form-control mb-3" rows="5"
        placeholder="Tulis testimoni kamu di sini..."></textarea>
      <button class="btn btn-warning w-100" onclick="kirimTestimoni()">
        Kirim Testimoni
      </button>

      <div id="msg" class="mt-3"></div>

    </div>
  </div>

</div>
<script src="testimoni.js"></script>
<script>
async function kirimTestimoni() {
  const isi = document.getElementById("isi").value.trim();
  const msg = document.getElementById("msg");

  if (!isi) {
    msg.innerHTML = `<div class="alert alert-danger">Testimoni tidak boleh kosong</div>`;
    return;
  }

  const form = new FormData();
  form.append("action", "addTestimoni");
  form.append("nama", localStorage.getItem("nama"));
  form.append("email", localStorage.getItem("email"));
  form.append("program_studi", localStorage.getItem("program_studi"));
  form.append("isi", isi);

  const res = await fetch(API, {
    method: "POST",
    body: form
  });

  const text = await res.text();

  if (text === "OK") {
    msg.innerHTML = `
      <div class="alert alert-success">
        ‚úÖ Testimoni berhasil dikirim<br>
        Menunggu persetujuan admin
      </div>`;
    document.getElementById("isi").value = "";
  } else {
    msg.innerHTML = `<div class="alert alert-danger">Gagal mengirim testimoni</div>`;
  }
}
</script>
<script>
if (
  localStorage.getItem("login") !== "true" ||
  localStorage.getItem("role") !== "alumni" ||
  localStorage.getItem("alumni_status") !== "Verified"
) {
  alert("Akses khusus alumni terverifikasi");
  location.href = "../index.html";
}
</script>
</body>
</html>
