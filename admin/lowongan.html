<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Kelola Lowongan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<script>
if (
  localStorage.getItem("login") !== "true" ||
  localStorage.getItem("role") !== "admin"
) {
  location.href = "../index.html";
}
</script>

<nav class="navbar bg-white shadow-sm">
  <div class="container">
    <span class="navbar-brand fw-bold">Kelola Lowongan</span>
    <a href="dashboard.html" class="btn btn-secondary btn-sm">‚Üê Kembali</a>
  </div>
</nav>

<div class="container mt-4">
  <div id="listLowongan" class="row g-3"></div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyDS1ml_xKj_1BAvS6_eD9sMbbYDShc3IFUtONn4jV117sDkHgr1TkxhjFm-DF1FqjAVw/exec";

async function loadLowongan() {
  const res = await fetch(API + "?action=getLowonganAdmin");
  const data = await res.json();

  const el = document.getElementById("listLowongan");
  el.innerHTML = "";

  data.forEach(l => {
    el.innerHTML += `
      <div class="col-md-6">
        <div class="card shadow-sm">
          <img src="${l.gambar || '../img/loker.png'}" class="card-img-top" style="height:200px;object-fit:cover">
          <div class="card-body">
            <h5>${l.judul}</h5>
            <p><b>${l.perusahaan}</b></p>
            <p>${l.lokasi}</p>
            <span class="badge ${l.status === 'Approved' ? 'bg-success' : 'bg-warning'}">
              ${l.status}
            </span>

            <div class="mt-3 d-flex gap-2">
              <button class="btn btn-success btn-sm"
                onclick="approve('${l.id}')">
                Approve
              </button>

              <button class="btn btn-danger btn-sm"
                onclick="hapus('${l.id}')">
                Hapus
              </button>
            </div>
          </div>
        </div>
      </div>
    `;
  });
}

async function approve(id) {
  if (!confirm("Approve lowongan ini?")) return;

  const form = new FormData();
  form.append("action", "approveLowongan");
  form.append("id", id);

  await fetch(API, { method: "POST", body: form });
  loadLowongan();
}

async function hapus(id) {
  if (!confirm("Hapus lowongan ini?")) return;

  const form = new FormData();
  form.append("action", "deleteLowongan");
  form.append("id", id);

  await fetch(API, { method: "POST", body: form });
  loadLowongan();
}

loadLowongan();
</script>

</body>
</html>
