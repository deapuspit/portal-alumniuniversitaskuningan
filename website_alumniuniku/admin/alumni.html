<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Data Alumni</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-4">

  <div class="d-flex justify-content-between mb-3">
    <h4>Data Alumni</h4>
    <button class="btn btn-secondary btn-sm"
      onclick="location.href='dashboard.html'">‚Üê Kembali</button>
  </div>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Nama</th>
        <th>Email</th>
        <th>Program Studi</th>
        <th>Tahun</th>
        <th>Status</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="alumniTable"></tbody>
  </table>

</div>

<script src="../js/auth.js"></script>

<script>
const API = "https://script.google.com/macros/s/AKfycbyDS1ml_xKj_1BAvS6_eD9sMbbYDShc3IFUtONn4jV117sDkHgr1TkxhjFm-DF1FqjAVw/exec";

async function loadAlumni() {
  const res = await fetch(API + "?action=getAlumni");
  const data = await res.json();

  const tbody = document.getElementById("alumniTable");
  tbody.innerHTML = "";

  data.forEach(a => {
    tbody.innerHTML += `
      <tr>
        <td>${a.nama}</td>
        <td>${a.email}</td>
        <td>${a.program_studi}</td>
        <td>${a.tahun}</td>
        <td>
          <span class="badge ${a.status === 'Verified' ? 'bg-success' : 'bg-warning'}">
            ${a.status}
          </span>
        </td>
        <td>
          ${a.status === "Pending" ? `
            <button class="btn btn-success btn-sm"
              onclick="verify('${a.email}')">Verifikasi</button>
          ` : ``}

          <button class="btn btn-danger btn-sm"
            onclick="hapus('${a.email}')">Hapus</button>
        </td>
      </tr>`;
  });
}

async function verify(id) {
  if (!confirm("Verifikasi alumni ini?")) return;

  const form = new FormData();
  form.append("action", "verifyAlumni");
  form.append("id", id);

  await fetch(API, {
    method: "POST",
    body: form
  });

  alert("Alumni berhasil diverifikasi");
  loadAlumni();
}

async function hapus(id) {
  if (!confirm("Hapus data alumni ini?")) return;

  const form = new FormData();
  form.append("action", "deleteAlumni");
  form.append("id", id);

  await fetch(API, {
    method: "POST",
    body: form
  });

  alert("Data alumni berhasil dihapus");
  loadAlumni();
}
loadAlumni();
</script>

</body>
</html>
